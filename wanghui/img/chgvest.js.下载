(function(){var checkUrl="//service.zol.com.cn/user/ajax/vest/check.php?callback=?";var changeUrl="//service.zol.com.cn/user/ajax/vest/changeUser.php?callback=?";function changeUserLogin(){this.userid=this.getCookie("zol_userid");this.userObj={};this.vestBtn=false;this.changeBtn="siteVestBtn";this.callback=null;this.clickBtn=true}changeUserLogin.prototype={getCookie:function(cookieName){var cookieStr=document.cookie;var cookieStart=cookieStr.indexOf(decodeURIComponent(cookieName)+"=");if(cookieStart==-1){return false}cookieStart=cookieStart+(decodeURIComponent(cookieName)+"=").length;var cookieEnd=cookieStr.indexOf(";",cookieStart);if(cookieEnd==-1){cookieEnd=cookieStr.length}var cookieValue=cookieStr.substring(cookieStart,cookieEnd);return cookieValue},setCookie:function(name,value,life){var cookieStr="";if(life>0){cookieStr=new Date((new Date()).getTime()+life*86400*1000);cookieStr="; expires="+cookieStr.toGMTString()}document.cookie=name+"="+escape(value)+cookieStr+"; path=/; domain=.zol.com.cn;"},checkUserLogin:function(){var userid=this.getCookie(this.userCookie);if(userid.length>3){return true}return false},checkVestCatche:function(){var vestCatche=this.getCookie("zol_vest_user");var vestLen=parseInt(vestCatche.length);if(vestLen>3&&vestCatche==this.userid){return true}},checkNoVestCatche:function(){var mark=this.getCookie("zol_vest_no");var markLen=parseInt(mark.length);if(markLen>3&&mark==this.userid){return true}return false},getEditVestFunc:function(showBtn){var self=this;$.ajax({url:checkUrl,type:"GET",async:false,dataType:"jsonp",jsonp:"jsoncallback",success:function(data){if(data.info=="ok"){self.userObj=data.msg;self.vestBtn=true;if(showBtn){self.getVestHtmlFunc()}else{self.checkSelectCallbackFunc()}}}});return true},checkUserVest:function(){var len=parseInt(this.userid.length);if(isNaN(len)||len<3){return false}var vestBtn=this.checkVestCatche();if(vestBtn){this.vestBtn=true;this.checkSelectCallbackFunc();return true}var normal=this.checkNoVestCatche();if(normal){this.vestBtn=false;return false}this.getEditVestFunc(false);return false},addChangeVestBtnFunc:function(){if(this.vestBtn){var item='<li><span id="'+this.changeBtn+'" style="line-height:30px;padding:0 5px;cursor:pointer;">';item+="\u5207\u6362\u9a6c\u7532</span></li>";$(".pub-bbs-login").prepend(item)}},getVestHtmlFunc:function(){var html='<div class="pop-bg" id="vestWindow" style="display: block;">';html+='<div class="pop-box">';html+='<div class="pop-box-head"><span class="pop-close"></span>\u6211\u7684\u9a6c\u7532\uff08\u70b9\u51fb\u5934\u50cf\u4e00\u952e\u5207\u6362\uff09</div>';html+='<div class="pop-box-centent">';html+='<ul class="clearfix">';for(i in this.userObj){if(typeof this.userObj[i]=="object"){html+="<li>";html+='<span class="pop-pic" data-uid="'+this.userObj[i]["userid"]+'">';html+='<img src="'+this.userObj[i]["photo"]+'" width="70" height="70">';html+="<em>"+this.userObj[i]["nickname"]+"</em>";html+="</span>";html+='<span class="item-bor" data-uid="'+this.userObj[i]["userid"]+'"></span>';html+="</li>"}}html+="</ul>";html+="</div>";html+="</div>";html+="</div>";$("head").append('<link rel="stylesheet" type="text/css" href="https://icon.zol-img.com.cn/css/module/z.common.module.voet.1.0.0.css" />');$("body").append(html);var self=this;$(".pop-close").live("click",function(){$("#vestWindow").hide();self.clickBtn=true});$("#vestWindow ul li").mouseenter(function(){$(this).addClass("current")}).mouseleave(function(){$(this).removeClass("current")});this.bindHeadpicClick()},bindHeadpicClick:function(){$("#vestWindow ul li span").click(function(){var userid=$(this).attr("data-uid");$.ajax({url:changeUrl,type:"GET",async:false,data:{userid:userid},dataType:"jsonp",jsonp:"jsoncallback",success:function(data){if(data.info=="ok"){$.ajax({url:data.sysLogin,type:"GET",dataType:"jsonp"});window.location.href=window.location.href}else{if(data.info=="error"){alert(data.msg);return false}}}})});return true},bindSiteBestBtnClick:function(){var self=this;$("#"+this.changeBtn).click(function(){if(!self.clickBtn){return false}self.clickBtn=false;if($("#vestWindow").length){$("#vestWindow").show();return false}var userNum=parseInt(self.userObj.length);if(isNaN(userNum)||userNum<=0){self.getEditVestFunc(true)}else{self.getVestHtmlFunc()}})},checkSelectCallbackFunc:function(){if(!this.vestBtn){return false}if(typeof this.callback=="function"){this.callback()}else{this.addChangeVestBtnFunc()}this.bindSiteBestBtnClick()},setItemidCallbackFunc:function(){var scriptObj=document.getElementsByTagName("script");var self=this;for(i in scriptObj){if($(scriptObj[i]).attr("data-id")){if($(scriptObj[i]).attr("data-id")=="editVestChange"){var paramStr=$(scriptObj[i]).attr("data-param");if(paramStr){var paramObj=$.parseJSON(paramStr);if(paramObj.id){self.changeBtn=paramObj.id}if(paramObj.callback){try{self.callback=eval(paramObj.callback)}catch(e){}}}return true}}}return false},init:function(){var self=this;this.setItemidCallbackFunc();this.checkUserVest()}};var changeObj=new changeUserLogin();changeObj.init()})();